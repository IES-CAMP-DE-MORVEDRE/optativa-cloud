# Tema 6. Microservicios y arquitecturas sin servidor

## Arquitectura de Microservicios

Los **microservicios** son un enfoque de arquitectura y organización para el desarrollo de software en el que las aplicaciones se componen de servicios independientes que se comunican mediante interfaces de programación de aplicaciones (API) bien definidas. 

Se podría decir que un *microservicio* es una pequeña aplicación independiente, especializada en una única función del sistema (por ejemplo: autenticación, pagos, notificaciones…).

Cada microservicio puede desarrollarse, desplegarse y escalarse de manera autónoma.

<img src="../images/ud06/ud06_01.png" width="600">

### Características de los microservicios

* **Desacoplamiento:** Cada servicio funciona y evoluciona por separado.
* **Especialización:** Cada uno cumple un propósito concreto.
* **Mensajería:** Se comunican por APIs normalmente REST, WebSockets o colas.
* **Escalabilidad independiente:** Si un servicio recibe más carga, solo ese escala.
* **Fallas aisladas:** Un fallo en un servicio no debe tumbar a toda la aplicación.

### Cómo implementar microservicios en AWS

AWS ofrece varias herramientas para crear microservicios:

| Servicio AWS              | Función                                                      |
| ------------------------- | ------------------------------------------------------------ |
| **AWS Lambda**            | Ejecuta código *sin servidor*.                               |
| **Amazon ECS**            | Ejecuta microservicios en contenedores (Docker).             |
| **Amazon EKS**            | Kubernetes gestionado para orquestación compleja.            |
| **AWS Fargate**           | Ejecuta contenedores sin gestionar servidores.               |
| **Amazon API Gateway**    | Exponer APIs REST/HTTP/WS para los microservicios.           |


!!! note "Nota"
    En este tema nos vamos a centrar en el servicio **AWS Lambda** y veremos cómo enlazarlo con **API Gateway** para crear mircroservicios.

---

## Arquitectura Serverless

Aunque se conoce como arquitectura sin servidor, *Serverless* no significa que no haya servidores, sino que **el desarrollador no gestiona la infraestructura**.

AWS se encarga de escalar, mantener y ejecutar el código bajo demanda.El usuario sólo debe subir el código y paga **únicamente por ejecución**, no por servidores encendidos.

### Componentes típicos en AWS

Entre los servicios *serverless* más utilizados en AWS se encuentran:

| Servicio AWS           | Uso                                                   |
| ---------------------- | ----------------------------------------------------- |
| **AWS Lambda**         | Ejecuta funciones bajo demanda sin servidores.        |
| **Amazon API Gateway** | Exponer endpoints HTTP/REST/WS para ejecutar Lambdas. |
| **Amazon DynamoDB**    | Base de datos NoSQL totalmente serverless.            |
| **AWS S3**             | Almacenamiento serverless de objetos.                 |

Pero no son los únicos, AWS tiene una gran cantidad de componentes que funcionan o pueden funcionar en modo *serverless*.

<img src="../images/ud06/ud06_02.png">

### Ventajas y desventajas del serverless

Entre las ventajas que encontramos al contratar servicios serverless tenemos:

* **Cero administración de servidores**.
* Escalabilidad automática.
* Pago por uso real (milisegundos).
* **Alta disponibilidad por defecto**.
* Despliegues más rápidos y sencillos.

Y como desventajas:

* **Cold start** en algunos lenguajes (tiempo para “despertar” la función).
* Sin control total sobre la infraestructura.
* Dependencia del proveedor.
* Límites en tiempo de ejecución y memoria.

---

## AWS Lambda

AWS Lambda es un servicio serverless que permite ejecutar código sin tener que gestionar servidores.

Solo pagamos **por el tiempo de ejecución** de nuestro código, no por tener servidores encendidos y es ideal para **tareas activadas por eventos**.


## Características principales

* **Compatible con varios lenguajes**: Python, Node.js, Java, C#, Go, etc.
* **Escalado automático:** Si se reciben muchas solicitudes, Lambda crea instancias automáticamente.
* **Basado en eventos:** Puede ejecutarse al ocurrir eventos (S3, API Gateway, DynamoDB…).
* **Stateless:** Cada ejecución es independiente.

## Funcionamiento típico

1. **Evento disparador:** Algo sucede (subida a S3, petición a API, cambio en DynamoDB…).
2. **Lambda se ejecuta:** Procesa el evento según el código subido.
3. **Resultado:** Puede guardar datos en DynamoDB, enviar un email, generar un archivo, un log …

<img src="../images/ud06/ud06_03.png">

## Ejemplos de uso

| Ejemplo                       | Disparador                     | Acción de Lambda                                 |
| ----------------------------- | ------------------------------ | ------------------------------------------------ |
| **Procesar imágenes**         | Archivo subido a S3            | Redimensionar imagen y guardar versión miniatura |
| **API RESTful**               | Petición POST a API Gateway    | Guardar datos en DynamoDB                        |
| **Notificaciones**            | Evento de DynamoDB             | Enviar email con SNS                             |
| **Automatización de backups** | Evento programado (CloudWatch) | Copiar archivos de un bucket a otro              |
| **Logs en tiempo real**       | Streams de CloudWatch          | Filtrar y enviar logs críticos a Slack o S3      |


---

## APIs

