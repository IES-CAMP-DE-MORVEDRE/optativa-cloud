# Tema 4. Almacenamiento en AWS

## Almacenamiento en la nube

El almacenamiento en la nube suele ser más fiable, escalable y seguro que los tradicionales sistemas de almacenamiento en las instalaciones. El almacenamiento en la nube es un componente fundamental del cómputo en la nube, pues contiene la información que utilizan las aplicaciones. El análisis de big data, los almacenes de datos, el Internet de las cosas (IoT), las bases de datos y las aplicaciones de copias de seguridad y archivado dependen de algún tipo de arquitectura de almacenamiento de datos. 

Dentro de la categoría de servicios básicos de almacenamiento de AWS encontramos:

- El **almacén de instancias**, o almacenamiento efímero. Es un **almacenamiento temporal** que se añade a una instancia de Amazon EC2. 
- **Amazon EBS**: un almacenamiento montable y persistente que se puede montar como dispositivo a una instancia de Amazon EC2. Solo una instancia de Amazon EC2 al mismo tiempo  puede montar un volumen de Amazon EBS. Equivale al disco virtual de la instancia EC2.
- **Amazon EFS**: un sistema de archivos compartidos que múltiples instancias de Amazon EC2 pueden montar en simultáneo. Como si fuera un NAS.
- **Amazon S3**: un almacenamiento persistente en el que cada archivo se convierte en un **objeto** que está disponible por medio de un localizador uniforme de recursos (URL) y al que se puede acceder desde cualquier lugar.
- **Amazon S3 Glacier**: es para el almacenamiento *en frío* de datos a los que no se accede con frecuencia (por ejemplo, cuando se necesita almacenamiento de datos a largo plazo por motivos de archivado o copia de seguridad).

## Almacenamiento a nivel de Bloque, Fichero y Objeto
Una diferencia clave entre algunos tipos de almacenamiento es saber si ofrecen almacenamiento en el nivel de bloque, a nivel de fichero o a nivel de objeto. 

<img src="../images/ud04/ud04_01.png" width="600">

Esta diferencia tiene un gran impacto en el rendimiento, la latencia y el costo de la solución de almacenamiento. Las soluciones de almacenamiento en bloque suelen ser más rápidas y utilizan menos ancho de banda, pero pueden costar más que el almacenamiento en el nivel de objeto. Pero muchas veces la elección vendrá condicionada por el tipo de uso que deseamos hacer.

**Almacenamiento en bloque (Block Storage)**

- Los datos se dividen en bloques de tamaño fijo (por ejemplo, 512 B o 4 KB).
- Cada bloque tiene una dirección, pero no contiene metadatos.
- El sistema operativo o la aplicación se encarga de organizar los bloques (por ejemplo, mediante un sistema de archivos).
- Ejemplo típico: Discos duros, SSD, volúmenes de máquinas virtuales (como los archivos *.vdi* de VirtualBox o como *Amazon EBS*).

**Almacenamiento de ficheros (File Storage)**

- Los datos se organizan en un sistema de archivos jerárquico (carpetas y subcarpetas).
- Los usuarios acceden a los archivos mediante rutas (por ejemplo, `/documentos/informe.pdf`).
- Se usa un protocolo de red como NFS (Linux/Unix) o SMB/CIFS (Windows) o *Amazon EFS*.
- Ejemplo típico: Servidores NAS, carpetas compartidas en red.

**Almacenamiento de objetos (Object Storage)**

- Los datos se almacenan como objetos completos, cada uno con:
    - El dato (contenido del archivo),
    - Un identificador único (ID o hash),
    - Y metadatos personalizados.
- No hay estructura jerárquica: los objetos se guardan en “buckets” (contenedores).
- Se accede normalmente mediante API HTTP/HTTPS (REST).
- Ejemplo típico: Amazon S3, Azure Blob Storage, Google Cloud Storage.

<br>

| Característica      | Bloques                   | Ficheros                       | Objetos                       |
| ------------------- | ------------------------- | ------------------------------ | ----------------------------- |
| **Organización**        | Bloques con dirección     | Árbol de carpetas y archivos   | Objetos con metadatos         |
| **Acceso**              | Bajo nivel (E/S directa)  | Ruta de archivo                | API o URL                     |
| **Protocolos comunes**  | iSCSI, Fibre Channel      | NFS, SMB/CIFS                  | HTTP/HTTPS (REST, S3 API)     |
| **Usos típicos**        | Bases de datos, discos VM | Servidores NAS, uso compartido | Backups, multimedia, big data |
| **Ejemplos en AWS**     | Amazon EBS                | Amazon EFS                     | Amazon S3                     |


En este tema veremos los siguientes servicios de AWS:

- Amazon Simple Storage Service (**Amazon S3**) --> Almacenamiento a nivel de Objetos
- Amazon Elastic Block Store (**Amazon EBS**) --> Almacenamiento a nivel de Bloques
- Amazon Elastic File System (**Amazon EFS**) --> Almacenamiento a nivel de Ficheros
- Amazon Simple Storage Service **Glacier** --> Almacenamiento a nivel de Objetos


## Amazon S3

**Amazon S3 (Simple Storage Service)** es un servicio administrado de almacenamiento a nivel de objetos en la nube de AWS.

Está diseñado para ofrecer una **alta durabilidad** (11 nueves: 99,999999999%), **escalabilidad automática** y **baja latencia** en el acceso a los datos.

Sus características principales son:

* Permite almacenar y gestionar objetos (archivos) de hasta 5 TB.
* Los objetos se guardan dentro de **buckets**, cuyos **nombres deben ser únicos** en todo Amazon S3.
* Por defecto, los datos se almacenan **de forma redundante** en múltiples instalaciones y dispositivos, sin que el usuario tenga que administrar servidores.

Se puede almacenar cualquier tipo de archivo: imágenes, vídeos, registros, copias de seguridad o instantáneas de bases de datos.


### Conceptos básicos de Amazon S3

Para utilizar Amazon S3, es importante entender algunos conceptos fundamentales:

**Buckets**:

* Son **contenedores lógicos** donde se almacenan los objetos (archivos).
* Cada bucket debe tener un **nombre único a nivel mundial**.
* Se puede **elegir la región** de AWS donde se almacenará el bucket (por ejemplo `us-east-1`).
* Se puede **controlar el acceso** a cada bucket (quién puede crear, eliminar o listar objetos).
* Permiten ver registros de acceso al bucket y a los objetos que contiene.

**Objetos**:

* Los archivos almacenados en S3 se llaman **objetos**.
* Un objeto está formado por:

    - **Datos** (el contenido del archivo).
    - **Metadatos** (información que lo describe, como permisos o URL).

* Se puede almacenar cualquier cantidad de objetos dentro de un bucket.
* Al cargar un archivo, se pueden definir permisos y metadatos personalizados.

<br>

Cada bucket y objeto tiene una **URL única**, aunque hay **dos estilos de URL** que pueden usarse para acceder a los objetos.

Ejemplo: un archivo `Preview2.mp4` dentro de un bucket tendrá una URL con el nombre del bucket y del objeto.

<img src="../images/ud04/ud04_02.png" width="600">

### Situaciones típicas de uso de S3
Aunque se puede almacenar cualquier tipo de dato, los casos de uso típico de S3 suelen ser:

- **Copia de seguridad y almacenamiento:** Se utiliza para guardar copias de seguridad y ofrecer servicios de almacenamiento de datos a terceros.

- **Alojamiento de aplicaciones:** Permite implementar, instalar y administrar aplicaciones web directamente desde la nube.

- **Alojamiento multimedia:** Ideal para crear infraestructuras redundantes, escalables y de alta disponibilidad que gestionen la carga y descarga de vídeos, imágenes o música.

- **Entrega de software:** Facilita el alojamiento de aplicaciones o instaladores para que los usuarios puedan descargarlos fácilmente.

<img src="../images/ud04/ud04_03.png" width="600">

### Control de acceso en Amazon S3

Por defecto, **todos los buckets de Amazon S3 son privados**, y solo los usuarios con permisos explícitos pueden acceder a ellos.

Es fundamental gestionar correctamente los permisos y la seguridad de los datos almacenados. Para ello disponemos de las siguientes herramientas y control de acceso:


**1. Bloqueo del acceso público:**

   - Impide que los buckets o los objetos sean accesibles públicamente.
   - Tiene prioridad sobre otras políticas o permisos.
   - Recomendado para evitar exposiciones accidentales de datos.

**2. Políticas de IAM (Identity and Access Management):**

   * Permiten definir qué **usuarios o roles** pueden acceder a determinados buckets u objetos.

**3. Políticas de bucket:**

   * Definen permisos específicos sobre un bucket o sus objetos.
   * Útiles cuando no se usa autenticación mediante IAM.
   * Pueden permitir acceso **entre cuentas** o incluso **público/anónimo**, por lo que deben configurarse con cuidado.
   * Pueden incluir **enunciados de denegación** para restringir el acceso incluso si otros permisos lo permiten.

**4. Puntos de acceso (Access Points):**

   * Cada punto de acceso tiene su **nombre de host**, **permisos** y **controles de red**.
   * Facilitan el acceso seguro y escalable a conjuntos de datos compartidos.

**5. Listas de control de acceso (ACL):**

   * Método antiguo, anterior a IAM.
   * Se recomienda usarlo solo cuando sea necesario y evitando configuraciones demasiado permisivas.

**6. AWS Trusted Advisor:**

   * Herramienta que **verifica los permisos de los buckets**.
   * Detecta si alguno tiene acceso global o configuraciones inseguras.

<img src="../images/ud04/ud04_04.png">

La situación del medio muestra una ocasión en que se ha desactivado la configuración de seguridad de S3 y cualquiera puede acceder públicamente a los objetos almacenados en el bucket, por ejemplo cuando alojamos un sitio web estático en un bucket S3. 

!!! danger "Atención"
    Usar un bucket de Amazon S3 para alojar un sitio web estático es una forma rápida de configurar una arquitectura en AWS, pero en la mayoría de los casos no se recomienda otorgar acceso público. Normalmente, S3 se utiliza para almacenar datos que son accedidos por aplicaciones externas o para guardar información confidencial y copias de seguridad, por lo que los buckets deben mantenerse privados para garantizar la seguridad de los datos.


## Amazon EBS

## Amazon EFS

## Amazon S3 Glacier

Práctica 1 --> Crear bucket, subir contenido y acceder a él (Con ACLs)
Práctica 2 --> Crear web estática en bucket S3 (Con políticas)
Práctica 3 --> Práctica guiada EBS. Creación de un volumen e instantánea y montaje en otra instancia. Última parte creación de un volumen en otra instancia, formateo y montaje manual.
Práctica 4 --> Práctica guiada EFS.
Práctica 5 (Opcional) --> CI/CD Web estática en S3 desde Github

https://aitor-medrano.github.io/bigdata2122/apuntes/nube04almacenamiento.html
https://aitor-medrano.github.io/iabd/cloud/s3.html


