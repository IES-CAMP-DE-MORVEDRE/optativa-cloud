# Tema 7. Modelo de Seguridad de AWS

## Modelo de Seguridad de AWS

El modelo de seguridad de AWS se basa en el principio de **responsabilidad compartida**: AWS asegura la **infraestructura**, y el cliente asegura **los datos y la configuración** de sus servicios.


### Responsabilidad compartida

| Parte       | Qué asegura                                                                                                           |
| ----------- | --------------------------------------------------------------------------------------------------------------------- |
| **AWS**     | Seguridad de la **infraestructura física**, hardware, redes, centros de datos y servicios gestionados.                |
| **Cliente** | Configuración de los servicios, control de acceso, cifrado de datos, seguridad de aplicaciones y sistemas operativos. |

!!! example "Ejemplo"
    En **EC2**, AWS asegura el hardware y la red, pero nosotros debemos proteger nuestro sistema operativo, usuarios y aplicaciones.


### Identidad y acceso (IAM)

AWS gestiona la autenticación y autorización mediante **IAM (Identity and Access Management)**:

* **Usuarios** y **grupos**: cuentas dentro de la organización.
* **Roles**: permisos temporales para servicios o usuarios externos.
* **Políticas**: reglas que definen qué acciones puede realizar un usuario o servicio sobre un recurso.

### Cifrado de datos

AWS permite cifrar datos **en reposo** y **en tránsito**:

* **En reposo:**

    * S3, EBS, RDS y DynamoDB soportan **cifrado con claves gestionadas por AWS ** o **propias**.

* **En tránsito:**

    * TLS/SSL para proteger la comunicación entre servicios y clientes.


### Red y perímetro

AWS protege la red mediante servicios y configuraciones:

* **VPC (Virtual Private Cloud):** redes privadas aisladas en la nube.
* **Subredes, ACLs y Security Groups:** control granular de tráfico entrante y saliente.
* **AWS Shield y WAF:** protección frente a ataques DDoS y filtrado de tráfico web malicioso.

### Monitorización y auditoría

* **CloudTrail:** registro de todas las acciones de API realizadas en la cuenta.
* **CloudWatch:** monitorización de métricas y eventos de los recursos.
* **GuardDuty:** detección de amenazas mediante análisis de logs y patrones sospechosos.


### Cumplimiento y certificaciones

AWS cumple con normas de seguridad y privacidad reconocidas internacionalmente.

Esto permite que las empresas confíen en la infraestructura para aplicaciones críticas y reguladas.


---

## AWS IAM (Identity and Access Management)

**AWS Identity and Access Management (IAM)** es el servicio de **gestión de identidades y control de acceso** de Amazon Web Services.

Permite administrar de forma segura quién puede acceder a los recursos de AWS y qué acciones puede realizar.

IAM es **gratuito** (no tiene coste adicional) y se integra en todos los servicios de AWS.

!!! info
    Es un componente central del modelo de seguridad de AWS y se basa en el **principio de mínimos privilegios**: cada usuario o servicio solo debe tener los permisos estrictamente necesarios para realizar su tarea.


### Usuario, Grupos, Roles y Políticas

IAM se organiza alrededor de **identidades, políticas y permisos**.

**Usuarios**

Representan **personas o aplicaciones** que necesitan acceder a AWS.

* Tienen **credenciales**: nombre de usuario y contraseña (para la consola web) o claves de acceso (para la CLI o APIs).
* Pueden añadirse a **grupos** o recibir permisos directamente.
* Ejemplo: `usuario_admin`, `usuario_lectura`, `aplicacion_api`.

**Grupos**

Conjuntos lógicos de usuarios con permisos comunes.

* Sirven para gestionar permisos de forma masiva.
* Ejemplo: grupo `Desarrolladores` con permisos sobre instancias EC2 y buckets S3.

**Roles**

Identidades **sin credenciales propias**, diseñadas para ser asumidas temporalmente por usuarios, servicios o recursos.

* Muy usados para otorgar permisos a **servicios de AWS** (como EC2 o Lambda) sin exponer claves.
* Ejemplo: una instancia EC2 que necesita leer un bucket S3 utiliza un rol IAM con ese permiso.

**Políticas (Policies)**

Son documentos en formato JSON que definen los permisos.

Las vemos con dentenimiento en el siguiente apratado.


### Autorización: cómo AWS decide si algo está permitido

Cada vez que un usuario o servicio hace una petición a AWS, IAM evalúa todas las políticas asociadas y aplica una lógica de decisión:

1. **Por defecto todo está denegado.**
2. Si una política **permite** la acción, pasa a estado *permitido provisionalmente*.
3. Si alguna política **deniega explícitamente** una acción, la petición **se bloquea siempre**.

Esto se conoce como el modelo *Deny by default*.


### Roles y delegación de permisos

Los **roles IAM** permiten **delegar permisos de forma temporal y controlada**.
Se usan, por ejemplo, para:

* Permitir que una **instancia EC2** acceda a un **bucket S3** sin usar claves.
* Conceder permisos temporales a usuarios externos o cuentas de otra organización (cross-account roles).
* Autorizar a servicios de AWS (como Lambda o ECS) para actuar en nombre del usuario.

!!! note "Nota"
    **IAM es el corazón de la seguridad en AWS:** controla quién entra, qué puede hacer y con qué recursos, garantizando una gestión centralizada, segura y flexible del acceso a la nube.



---

## Políticas de IAM en AWS

Las **políticas** son documentos en formato JSON que definen los permisos que se conceden o deniegan a un usuario, grupo o rol en AWS.

!!! abstract "Es decir..."
    Una política indica qué acciones puede realizar un sujeto (usuario, grupo o rol) sobre qué recursos y bajo qué condiciones.

Son el núcleo del modelo de control de acceso en AWS: **sin una política asociada, ningún usuario o servicio tiene permisos.**


* Especifican:

    * **Acciones** (`Action`): qué operaciones se permiten o deniegan.
    * **Recursos** (`Resource`): sobre qué objetos se aplican.
    * **Efecto** (`Effect`): `Allow` o `Deny`.

Cuando un usuario intenta realizar una acción, AWS evalúa las políticas siguiendo este orden:

1. **Denegación explícita (Deny)** → siempre prevalece.
2. **Permiso explícito (Allow)** → concede acceso si no hay una denegación previa.
3. **Por defecto, todo está denegado** hasta que una política lo permita.

!!! note "Regla de oro"
    Si no hay una política `Allow`, la acción no se ejecutará.

* Ejemplo de política simple:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": ["s3:ListBucket", "s3:GetObject"],
      "Resource": ["arn:aws:s3:::mi-bucket", "arn:aws:s3:::mi-bucket/*"]
    }
  ]
}
```

---

### Tipos de políticas

AWS ofrece varios tipos de políticas, clasificadas según cómo y dónde se aplican:

| Tipo de política                 | Descripción                                                                                                  | Ejemplo                                                      |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------ |
| **Administradas por AWS**        | Políticas predefinidas creadas y mantenidas por AWS. Simplifican la gestión y se actualizan automáticamente. | `AmazonS3ReadOnlyAccess`, `AdministratorAccess`              |
| **Administradas por el cliente** | Políticas personalizadas creadas por el usuario para definir permisos específicos.                           | Política que permite acceso de lectura a un bucket concreto. |
| **Inline (insertadas)**          | Políticas directamente incrustadas en un usuario, grupo o rol concreto. No son reutilizables.                | Política personalizada dentro de un rol de EC2.              |


---

### Estructura y sintaxis de una política (JSON)

Las políticas de IAM siguen una estructura **JSON** con campos obligatorios y opcionales:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::mi-bucket",
        "arn:aws:s3:::mi-bucket/*"
      ],
      "Condition": {
        "IpAddress": {
          "aws:SourceIp": "203.0.113.0/24"
        }
      }
    }
  ]
}
```

**Desglose de los campos:**

| Campo         | Descripción                                                                                                             | Obligatorio |
| ------------- | ----------------------------------------------------------------------------------------------------------------------- | :-----------: |
| **Version**   | Indica la versión del lenguaje de políticas. Actualmente se usa `"2012-10-17"`.                                         |    ✅        |
| **Statement** | Lista de reglas que definen permisos. Puede contener una o varias.                                                      |    ✅        |
| **Effect**    | Determina si la acción se **permite** (`Allow`) o **deniega** (`Deny`).                                                 |    ✅        |
| **Action**    | Especifica las **acciones** de AWS que se permiten o deniegan (por ejemplo, `s3:PutObject`, `ec2:StartInstances`).      |    ✅        |
| **Resource**  | Indica los recursos específicos sobre los que se aplican los permisos, usando su ARN.                                   |    ✅        |
| **Condition** | Define condiciones opcionales (por IP, usuario, hora, MFA, etc.) que deben cumplirse para que se concedan los permisos. |    ❌        |

---

### Ejemplo práctico: política personalizada

**Objetivo:** Permitir a un usuario listar y leer objetos del bucket `iescamp-datos`, pero no borrarlos.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "LeerBucketIESCAMP",
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket",
        "s3:GetObject"
      ],
      "Resource": [
        "arn:aws:s3:::iescamp-datos",
        "arn:aws:s3:::iescamp-datos/*"
      ]
    }
  ]
}
```

> *Sid (Statement ID)*: campo opcional para identificar el bloque de permisos.

Los **ARN (Amazon Resource Names)** identifican de forma única los recursos en AWS.

**Ejemplo de estructura:**

```
arn:aws:servicio:región:cuenta:recurso
```

**Ejemplo para un bucket S3:**

```
arn:aws:s3:::mi-bucket
arn:aws:s3:::mi-bucket/mis-archivos/*
```
