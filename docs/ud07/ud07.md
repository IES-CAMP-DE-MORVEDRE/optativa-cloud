# Tema 7. Modelo de Seguridad de AWS

## Modelo de Seguridad de AWS

El modelo de seguridad de AWS se basa en el principio de **responsabilidad compartida**: AWS asegura la **infraestructura**, y el cliente asegura **los datos y la configuraciÃ³n** de sus servicios.


### Responsabilidad compartida

| Parte       | QuÃ© asegura                                                                                                           |
| ----------- | --------------------------------------------------------------------------------------------------------------------- |
| **AWS**     | Seguridad de la **infraestructura fÃ­sica**, hardware, redes, centros de datos y servicios gestionados.                |
| **Cliente** | ConfiguraciÃ³n de los servicios, control de acceso, cifrado de datos, seguridad de aplicaciones y sistemas operativos. |

> Ejemplo: en **EC2**, AWS asegura el hardware y la red, pero nosotros debemos proteger nuestro sistema operativo, usuarios y aplicaciones.


### Identidad y acceso (IAM)

AWS gestiona la autenticaciÃ³n y autorizaciÃ³n mediante **IAM (Identity and Access Management)**:

* **Usuarios** y **grupos**: cuentas dentro de la organizaciÃ³n.
* **Roles**: permisos temporales para servicios o usuarios externos.
* **PolÃ­ticas**: reglas que definen quÃ© acciones puede realizar un usuario o servicio sobre un recurso.

### Cifrado de datos

AWS permite cifrar datos **en reposo** y **en trÃ¡nsito**:

* **En reposo:**

    * S3, EBS, RDS y DynamoDB soportan **cifrado con claves gestionadas por AWS (SSE)** o **propias (CMK)**.

* **En trÃ¡nsito:**

    * TLS/SSL para proteger la comunicaciÃ³n entre servicios y clientes.


### Red y perÃ­metro

AWS protege la red mediante servicios y configuraciones:

* **VPC (Virtual Private Cloud):** redes privadas aisladas en la nube.
* **Subredes, ACLs y Security Groups:** control granular de trÃ¡fico entrante y saliente.
* **AWS Shield y WAF:** protecciÃ³n frente a ataques DDoS y filtrado de trÃ¡fico web malicioso.

### MonitorizaciÃ³n y auditorÃ­a

* **CloudTrail:** registro de **todas las acciones de API** realizadas en la cuenta.
* **CloudWatch:** monitorizaciÃ³n de mÃ©tricas y eventos de los recursos.
* **GuardDuty:** detecciÃ³n de amenazas mediante anÃ¡lisis de logs y patrones sospechosos.


### Cumplimiento y certificaciones

AWS cumple con normas de seguridad y privacidad reconocidas internacionalmente.

Esto permite que las empresas confÃ­en en la infraestructura para **aplicaciones crÃ­ticas y reguladas**.


---

## AWS IAM (Identity and Access Management)

**AWS Identity and Access Management (IAM)** es el servicio de **gestiÃ³n de identidades y control de acceso** de Amazon Web Services.
Permite **administrar de forma segura quiÃ©n puede acceder a los recursos de AWS y quÃ© acciones puede realizar**.

IAM es **gratuito** (no tiene coste adicional) y se integra en todos los servicios de AWS.
Es un componente **central del modelo de seguridad de AWS** y se basa en el **principio de mÃ­nimos privilegios**: cada usuario o servicio solo debe tener los permisos estrictamente necesarios para realizar su tarea.


### Usuario, Grupos, Roles y PolÃ­ticas

IAM se organiza alrededor de **identidades, polÃ­ticas y permisos**.

**Usuarios**

Representan **personas o aplicaciones** que necesitan acceder a AWS.

* Tienen **credenciales**: nombre de usuario y contraseÃ±a (para la consola web) o claves de acceso (para la CLI o APIs).
* Pueden aÃ±adirse a **grupos** o recibir permisos directamente.
* Ejemplo: `usuario_admin`, `usuario_lectura`, `aplicacion_api`.

**Grupos**

Conjuntos lÃ³gicos de usuarios con permisos comunes.

* Sirven para **gestionar permisos de forma masiva**.
* Ejemplo: grupo `Desarrolladores` con permisos sobre instancias EC2 y buckets S3.

**Roles**

Identidades **sin credenciales propias**, diseÃ±adas para ser **asumidas temporalmente** por usuarios, servicios o recursos.

* Muy usados para otorgar permisos a **servicios de AWS** (como EC2 o Lambda) sin exponer claves.
* Ejemplo: una instancia EC2 que necesita leer un bucket S3 utiliza un **rol IAM** con ese permiso.

**PolÃ­ticas (Policies)**

Son **documentos en formato JSON** que **definen los permisos**.

Las vemos con dentenimiento en el siguiente apratado.


### AutorizaciÃ³n: cÃ³mo AWS decide si algo estÃ¡ permitido

Cada vez que un usuario o servicio hace una peticiÃ³n a AWS, IAM evalÃºa **todas las polÃ­ticas asociadas** y aplica una **lÃ³gica de decisiÃ³n**:

1. **Por defecto todo estÃ¡ denegado.**
2. Si una polÃ­tica **permite** la acciÃ³n, pasa a estado *permitido provisionalmente*.
3. Si alguna polÃ­tica **deniega explÃ­citamente** una acciÃ³n, la peticiÃ³n **se bloquea siempre**.

Esto se conoce como el modelo **Deny by default**.


### Roles y delegaciÃ³n de permisos

Los **roles IAM** permiten **delegar permisos de forma temporal y controlada**.
Se usan, por ejemplo, para:

* Permitir que una **instancia EC2** acceda a un **bucket S3** sin usar claves.
* Conceder permisos temporales a **usuarios externos o cuentas de otra organizaciÃ³n (cross-account roles)**.
* Autorizar a servicios de AWS (como Lambda o ECS) para actuar en nombre del usuario.

> **IAM es el corazÃ³n de la seguridad en AWS:** controla quiÃ©n entra, quÃ© puede hacer y con quÃ© recursos, garantizando una gestiÃ³n centralizada, segura y flexible del acceso a la nube.



---

## PolÃ­ticas de IAM en AWS

### 1. Â¿QuÃ© son las polÃ­ticas en AWS IAM?

Las **polÃ­ticas** son **documentos en formato JSON** que definen los **permisos** que se conceden o deniegan a un usuario, grupo o rol en AWS.
En esencia, **una polÃ­tica indica quÃ© acciones puede realizar un sujeto (usuario, grupo o rol) sobre quÃ© recursos y bajo quÃ© condiciones**.

Son el **nÃºcleo del modelo de control de acceso** en AWS: sin una polÃ­tica asociada, ningÃºn usuario o servicio tiene permisos.


* Especifican:

  * **Acciones** (`Action`): quÃ© operaciones se permiten o deniegan.
  * **Recursos** (`Resource`): sobre quÃ© objetos se aplican.
  * **Efecto** (`Effect`): `Allow` o `Deny`.
* Ejemplo de polÃ­tica simple:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": ["s3:ListBucket", "s3:GetObject"],
      "Resource": ["arn:aws:s3:::mi-bucket", "arn:aws:s3:::mi-bucket/*"]
    }
  ]
}
```

---

### 2. Tipos de polÃ­ticas

AWS ofrece varios tipos de polÃ­ticas, clasificadas segÃºn cÃ³mo y dÃ³nde se aplican:

| Tipo de polÃ­tica                 | DescripciÃ³n                                                                                                  | Ejemplo                                                      |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------ |
| **Administradas por AWS**        | PolÃ­ticas predefinidas creadas y mantenidas por AWS. Simplifican la gestiÃ³n y se actualizan automÃ¡ticamente. | `AmazonS3ReadOnlyAccess`, `AdministratorAccess`              |
| **Administradas por el cliente** | PolÃ­ticas personalizadas creadas por el usuario para definir permisos especÃ­ficos.                           | PolÃ­tica que permite acceso de lectura a un bucket concreto. |
| **Inline (insertadas)**          | PolÃ­ticas directamente incrustadas en un usuario, grupo o rol concreto. No son reutilizables.                | PolÃ­tica personalizada dentro de un rol de EC2.              |


---

### 3. Estructura y sintaxis de una polÃ­tica (JSON)

Las polÃ­ticas de IAM siguen una estructura **JSON** con campos obligatorios y opcionales:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::mi-bucket",
        "arn:aws:s3:::mi-bucket/*"
      ],
      "Condition": {
        "IpAddress": {
          "aws:SourceIp": "203.0.113.0/24"
        }
      }
    }
  ]
}
```

#### ğŸ” Desglose de los campos:

| Campo         | DescripciÃ³n                                                                                                             | Obligatorio |
| ------------- | ----------------------------------------------------------------------------------------------------------------------- | ----------- |
| **Version**   | Indica la versiÃ³n del lenguaje de polÃ­ticas. Actualmente se usa `"2012-10-17"`.                                         | âœ…           |
| **Statement** | Lista de reglas que definen permisos. Puede contener una o varias.                                                      | âœ…           |
| **Effect**    | Determina si la acciÃ³n se **permite** (`Allow`) o **deniega** (`Deny`).                                                 | âœ…           |
| **Action**    | Especifica las **acciones** de AWS que se permiten o deniegan (por ejemplo, `s3:PutObject`, `ec2:StartInstances`).      | âœ…           |
| **Resource**  | Indica los recursos especÃ­ficos sobre los que se aplican los permisos, usando su ARN.                                   | âœ…           |
| **Condition** | Define condiciones opcionales (por IP, usuario, hora, MFA, etc.) que deben cumplirse para que se concedan los permisos. | âŒ           |

---

### 4. ARN (Amazon Resource Name)

Los **ARN (Amazon Resource Names)** identifican de forma Ãºnica los recursos en AWS.

Ejemplo de estructura:

```
arn:aws:servicio:regiÃ³n:cuenta:recurso
```

ğŸ“˜ Ejemplo para un bucket S3:

```
arn:aws:s3:::mi-bucket
arn:aws:s3:::mi-bucket/mis-archivos/*
```

---

### 5. Ejemplo prÃ¡ctico: polÃ­tica personalizada

**Objetivo:** Permitir a un usuario listar y leer objetos del bucket `asir-datos`, pero no borrarlos.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "LeerBucketASIR",
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket",
        "s3:GetObject"
      ],
      "Resource": [
        "arn:aws:s3:::asir-datos",
        "arn:aws:s3:::asir-datos/*"
      ]
    }
  ]
}
```

ğŸ“˜ *Sid (Statement ID)*: campo opcional para identificar el bloque de permisos.

---

### 6. Condiciones en polÃ­ticas (Conditions)

Las condiciones permiten aplicar **control contextual**.
Se definen mediante operadores y claves de condiciÃ³n.

Ejemplo: permitir acceso solo desde una IP concreta y con MFA activado.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "ec2:*",
      "Resource": "*",
      "Condition": {
        "IpAddress": {"aws:SourceIp": "192.0.2.0/24"},
        "Bool": {"aws:MultiFactorAuthPresent": "true"}
      }
    }
  ]
}
```

---

### 7. Principio del **menor privilegio**

Una **mejor prÃ¡ctica fundamental** en IAM es aplicar el **Principio del Menor Privilegio** (*Least Privilege*):

> Conceder solo los permisos mÃ­nimos necesarios para realizar una tarea concreta.

Esto reduce el riesgo de accesos indebidos y daÃ±os accidentales.

---

### 8. EvaluaciÃ³n de polÃ­ticas (cÃ³mo AWS decide si algo estÃ¡ permitido)

Cuando un usuario intenta realizar una acciÃ³n, AWS evalÃºa las polÃ­ticas siguiendo este orden:

1. **DenegaciÃ³n explÃ­cita (Deny)** â†’ siempre prevalece.
2. **Permiso explÃ­cito (Allow)** â†’ concede acceso si no hay una denegaciÃ³n previa.
3. **Por defecto, todo estÃ¡ denegado** hasta que una polÃ­tica lo permita.

ğŸ‘‰ **Regla de oro:**
Si no hay una polÃ­tica `Allow`, la acciÃ³n no se ejecutarÃ¡.

---

### 9. CreaciÃ³n de polÃ­ticas en la consola de AWS

Pasos bÃ¡sicos para crear una polÃ­tica personalizada:

1. En la consola, ir a **IAM â†’ Policies â†’ Create policy**.
2. Elegir entre el **modo visual** (seleccionar servicio, acciones, recursos) o **modo JSON**.
3. Revisar los permisos y guardar.
4. Asignar la polÃ­tica a un **usuario, grupo o rol**.

---

### 10. Buenas prÃ¡cticas con polÃ­ticas IAM

* âœ… Usar **polÃ­ticas administradas por AWS** siempre que sea posible.
* ğŸ§© Crear **polÃ­ticas administradas por el cliente** para necesidades especÃ­ficas.
* ğŸš« Evitar el uso de `"Resource": "*"`, salvo en polÃ­ticas muy controladas.
* ğŸ•µï¸â€â™‚ï¸ Revisar polÃ­ticas con **IAM Access Analyzer** para detectar permisos excesivos.
* ğŸ” Activar **MFA (autenticaciÃ³n multifactor)** y combinar con condiciones de acceso.
* ğŸ“œ Versionar polÃ­ticas y usar nombres descriptivos.

---


---

## ğŸ§© **AsignaciÃ³n de polÃ­ticas en AWS IAM**

Una vez creada una polÃ­tica (ya sea **administrada** o **personalizada**), el siguiente paso es **asignarla a una entidad de IAM**, que puede ser:

* Un **usuario** (identity individual).
* Un **grupo de usuarios** (para aplicar permisos comunes).
* Un **rol** (para servicios, cuentas externas o accesos temporales).

---

### ğŸ”¹ **1. Asignar una polÃ­tica a un usuario**

#### Desde la **consola de AWS**:

1. Ve a **IAM â†’ Users**.
2. Selecciona el **usuario** al que quieres aplicar permisos.
3. En la pestaÃ±a **Permissions**, haz clic en **Add permissions**.
4. Elige una de las opciones:

   * **Attach policies directly** â†’ seleccionas una polÃ­tica existente (administrada o personalizada).
   * **Add user to group** â†’ si el grupo ya tiene la polÃ­tica asociada, el usuario hereda los permisos.
   * **Copy permissions from existing user** â†’ clona permisos de otro usuario.
5. Haz clic en **Next**, revisa y **Add permissions**.

ğŸ“˜ *Resultado:* el usuario ahora tiene los permisos definidos en la polÃ­tica.

---

### ğŸ”¹ **2. Asignar una polÃ­tica a un grupo**

Esto es muy Ãºtil cuando varios usuarios necesitan los mismos permisos.

1. En **IAM â†’ User groups**, selecciona o crea un grupo.
2. En la pestaÃ±a **Permissions**, selecciona **Attach policy**.
3. Marca las polÃ­ticas que quieres aplicar y **Add permissions**.

ğŸ“˜ *Todos los usuarios del grupo heredan automÃ¡ticamente esas polÃ­ticas.*

---

### ğŸ”¹ **3. Asignar una polÃ­tica a un rol**

Los **roles** se usan cuando una **entidad no humana (servicio o aplicaciÃ³n)** necesita actuar con permisos temporales.

Ejemplo: una instancia **EC2** que necesita leer datos de **S3**.

#### Pasos:

1. Ve a **IAM â†’ Roles â†’ Create role**.
2. Elige el tipo de entidad que asumirÃ¡ el rol (por ejemplo, **EC2**).
3. En el paso de permisos, selecciona las polÃ­ticas que se aplicarÃ¡n al rol.
4. NÃ³mbralo y crÃ©alo.
5. Asocia el rol a tu servicio (por ejemplo, al lanzar una instancia EC2).

ğŸ“˜ *El servicio asumirÃ¡ ese rol y obtendrÃ¡ temporalmente los permisos definidos.*

---

### ğŸ”¹ **4. Desde la AWS CLI**

TambiÃ©n puedes asociar polÃ­ticas desde la **lÃ­nea de comandos**, usando el comando `aws iam attach-*`.

Ejemplos:

#### A un usuario:

```bash
aws iam attach-user-policy \
  --user-name usuario-asir \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
```

#### A un grupo:

```bash
aws iam attach-group-policy \
  --group-name grupo-asir \
  --policy-arn arn:aws:iam::aws:policy/AmazonEC2FullAccess
```

#### A un rol:

```bash
aws iam attach-role-policy \
  --role-name rol-lectura-s3 \
  --policy-arn arn:aws:iam::123456789012:policy/LecturaS3Personalizada
```

---

### ğŸ”¹ **5. VisualizaciÃ³n de polÃ­ticas asociadas**

Desde la consola o CLI, puedes comprobar quÃ© polÃ­ticas tiene una entidad:

**Consola:**

* En el perfil del usuario, grupo o rol â†’ pestaÃ±a **Permissions**.

**CLI:**

```bash
aws iam list-attached-user-policies --user-name usuario-asir
```

---

### ğŸ”¹ **6. Prioridad y combinaciÃ³n de polÃ­ticas**

AWS combina **todas las polÃ­ticas adjuntas** a una entidad (usuario + grupo + rol).
El resultado final es la **uniÃ³n de todos los permisos `Allow`**, excepto si hay un **`Deny` explÃ­cito**, que **siempre prevalece**.

ğŸ“˜ Ejemplo:

* El grupo permite `s3:GetObject`.
* Una polÃ­tica inline en el usuario hace `Deny` sobre `s3:GetObject`.
  â†’ El acceso **se deniega**, porque el *Deny explÃ­cito* tiene prioridad.

---

### ğŸ”¹ **7. PolÃ­ticas inline vs. adjuntas**

| Tipo                  | DescripciÃ³n                                                                | Uso recomendado                         |
| --------------------- | -------------------------------------------------------------------------- | --------------------------------------- |
| **Adjunta (managed)** | PolÃ­tica independiente que se enlaza a uno o mÃ¡s usuarios, grupos o roles. | ğŸ”¹ Reutilizable y fÃ¡cil de mantener.    |
| **Inline**            | PolÃ­tica escrita dentro del propio usuario, grupo o rol.                   | ğŸ”¹ Para casos muy especÃ­ficos y Ãºnicos. |

---

### âœ… **Resumen rÃ¡pido**

| AcciÃ³n                      | DÃ³nde se hace                      | Resultado                                 |
| --------------------------- | ---------------------------------- | ----------------------------------------- |
| **Attach policy a usuario** | IAM â†’ Users â†’ Add permissions      | Aplica directamente la polÃ­tica.          |
| **Attach policy a grupo**   | IAM â†’ Groups â†’ Attach policy       | Todos los usuarios heredan los permisos.  |
| **Attach policy a rol**     | IAM â†’ Roles â†’ Create/Attach policy | El servicio o entidad asume los permisos. |
| **CLI**                     | `aws iam attach-*`                 | Permite automatizar la asignaciÃ³n.        |

---


